<!doctype html>
<html lang="bn">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>HackerView — Bike Live</title>

<!-- FONT + STYLES -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{--bg:#071425;--panel:rgba(255,255,255,0.03);--accent:#00d1ff;--muted:#9fb3c8}
  html,body{height:100%;margin:0;background:linear-gradient(180deg,#020617 0%, #071425 100%);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:#dbeefc}
  .app{height:100%;display:flex;flex-direction:column}
  header{height:64px;display:flex;align-items:center;justify-content:space-between;padding:0 20px;background:linear-gradient(90deg,#021528,#05213a);box-shadow:0 8px 30px rgba(0,0,0,0.6)}
  header h1{font-size:16px;margin:0;letter-spacing:0.6px}
  header .sub{font-size:13px;color:var(--muted)}
  /* main area */
  .main{flex:1;position:relative;display:flex;align-items:stretch}
  /* iframe container */
  .frame-wrap{flex:1;background:#000;border-radius:8px;margin:18px;overflow:hidden;display:flex;align-items:center;justify-content:center;position:relative}
  iframe#mapFrame{width:100%;height:100%;border:0;transform-origin:center center;transition:transform 200ms ease}
  /* overlay controls */
  .controls{position:absolute;right:24px;top:24px;background:var(--panel);backdrop-filter:blur(6px);padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.02);display:flex;flex-direction:column;gap:8px;min-width:120px}
  .controls .row{display:flex;gap:8px}
  .btn{background:transparent;border:1px solid rgba(255,255,255,0.04);color:#dbeefc;padding:8px;border-radius:8px;cursor:pointer;font-weight:600}
  .btn.primary{background:linear-gradient(90deg,var(--accent),#037fff);color:#002;padding:8px 10px}
  .small{font-size:12px;color:var(--muted)}
  /* bottom info */
  .bottom-left{position:absolute;left:24px;bottom:24px;background:var(--panel);padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.02);color:var(--muted);font-size:13px}
  /* responsive */
  @media (max-width:720px){
    header{padding:0 12px}
    .controls{right:12px;top:12px;min-width:100px}
    .frame-wrap{margin:12px}
  }
</style>
</head>
<body>
<div class="app">
  <header>
    <div>
      <h1>HackerView</h1>
      <div class="sub">Live bike tracker — stealth window</div>
    </div>
    <div class="sub" id="statusText">Status: —</div>
  </header>

  <div class="main">
    <div class="frame-wrap" id="frameWrap">
      <!-- iframe loads the permanent sharing link (no textual link shown anywhere) -->
      <iframe id="mapFrame" src="about:blank" sandbox></iframe>

      <!-- floating controls -->
      <div class="controls" id="controls">
        <div class="row">
          <button class="btn" id="zoomIn">Zoom +</button>
          <button class="btn" id="zoomOut">Zoom −</button>
        </div>
        <div class="row">
          <button class="btn" id="refreshBtn">Refresh</button>
          <button class="btn primary" id="fullscreenBtn">Fullscreen</button>
        </div>
        <div class="row">
          <button class="btn" id="autoToggle">Auto: OFF</button>
          <select id="interval" class="btn" style="padding:6px;">
            <option value="10">10s</option>
            <option value="20" selected>20s</option>
            <option value="30">30s</option>
            <option value="60">60s</option>
          </select>
        </div>
      </div>

      <div class="bottom-left" id="infoBox">Last update: —</div>
    </div>
  </div>
</div>

<script>
/* ============================
  CONFIG - এখানে তোমার sharing link বসানো আছে
  (তুমি চাইলে অন্য link দিয়ে বদলে দিবে)
============================ */
const SHARING_LINK = 'http://gps.francebangla.net/sharing/3cc72e30b02e2948c35e7c96ba602695';

/* Elements */
const mapFrame = document.getElementById('mapFrame');
const statusText = document.getElementById('statusText');
const infoBox = document.getElementById('infoBox');
const zoomIn = document.getElementById('zoomIn');
const zoomOut = document.getElementById('zoomOut');
const refreshBtn = document.getElementById('refreshBtn');
const fullscreenBtn = document.getElementById('fullscreenBtn');
const autoToggle = document.getElementById('autoToggle');
const intervalSel = document.getElementById('interval');
const frameWrap = document.getElementById('frameWrap');

let scale = 1;
let autoTimer = null;

/* Load iframe */
function loadFrame(){
  // set src (no visible textual link)
  mapFrame.src = SHARING_LINK;
  statusText.textContent = 'Status: Loading...';
  infoBox.textContent = 'Last update: Loading...';
  // if iframe loads fine, we update status; otherwise fallback will open new tab
  mapFrame.onload = ()=> {
    statusText.textContent = 'Status: Embedded';
    infoBox.textContent = 'Last update: ' + new Date().toLocaleString();
  };
  // short timeout: if not loaded in time, assume blocked -> open new tab silently
  setTimeout(()=>{
    // if iframe still about:blank or didn't load (can't reliably check cross-origin),
    // try a reachability probe and then open new tab as fallback if unreachable in iframe.
    // We'll check whether iframe has loaded event set the status to 'Embedded'.
    if(statusText.textContent !== 'Status: Embedded'){
      // attempt to probe fetch (best-effort)
      probe(SHARING_LINK, 5000).then(ok=>{
        if(ok){
          // embedding likely blocked — open in new tab automatically for best viewing experience
          statusText.textContent = 'Status: Embed blocked — opening new tab';
          window.open(SHARING_LINK, '_blank');
          infoBox.textContent = 'Opened in new tab (embed blocked)';
        } else {
          statusText.textContent = 'Status: Unreachable';
          infoBox.textContent = 'Server unreachable';
        }
      });
    }
  }, 1800);
}

/* probe by loading an image (non-CORS) to test reachability */
function probe(url, timeout=4000){
  return new Promise(resolve=>{
    try{
      const img = new Image();
      let done = false;
      img.onload = ()=> { if(!done){ done=true; resolve(true); } };
      img.onerror = ()=> { if(!done){ done=true; resolve(false); } };
      img.src = url + (url.includes('?')? '&':'?') + '_ping=' + Date.now();
      setTimeout(()=> { if(!done){ done=true; resolve(false); } }, timeout);
    } catch(e){ resolve(false); }
  });
}

/* Zoom controls - we scale iframe content (works visually) */
function applyScale(){
  mapFrame.style.transform = 'scale(' + scale + ')';
}
zoomIn.addEventListener('click', ()=> { scale = Math.min(2.5, scale + 0.15); applyScale(); });
zoomOut.addEventListener('click', ()=> { scale = Math.max(0.5, scale - 0.15); applyScale(); });

/* Refresh */
refreshBtn.addEventListener('click', ()=> {
  mapFrame.src = mapFrame.src; // reload
  infoBox.textContent = 'Last update: ' + new Date().toLocaleString();
});

/* Fullscreen toggle for frameWrap */
fullscreenBtn.addEventListener('click', ()=> {
  if(!document.fullscreenElement) frameWrap.requestFullscreen().catch(()=>{});
  else document.exitFullscreen().catch(()=>{});
});

/* Auto refresh */
autoToggle.addEventListener('click', ()=> {
  if(autoTimer){ clearInterval(autoTimer); autoTimer = null; autoToggle.textContent = 'Auto: OFF'; infoBox.textContent = 'Auto refresh stopped'; }
  else {
    const sec = parseInt(intervalSel.value,10) * 1000;
    autoTimer = setInterval(()=> {
      mapFrame.src = mapFrame.src;
      infoBox.textContent = 'Last auto-refresh: ' + new Date().toLocaleString();
    }, sec);
    autoToggle.textContent = 'Auto: ON';
    infoBox.textContent = 'Auto refresh started';
  }
});

/* Keyboard shortcuts (Hacker feel) */
window.addEventListener('keydown', (e)=>{
  if(e.key === '+') { scale = Math.min(2.5, scale + 0.15); applyScale(); }
  if(e.key === '-') { scale = Math.max(0.5, scale - 0.15); applyScale(); }
  if(e.key === 'r') { mapFrame.src = mapFrame.src; infoBox.textContent = 'Manual refresh: ' + new Date().toLocaleString(); }
  if(e.key === 'f') { if(!document.fullscreenElement) frameWrap.requestFullscreen().catch(()=>{}); else document.exitFullscreen().catch(()=>{}); }
});

/* initial load */
loadFrame();

/* try to keep iframe in center (prevent scroll when scaled) */
mapFrame.addEventListener('mouseenter', ()=> { mapFrame.style.pointerEvents = 'auto'; });
mapFrame.addEventListener('mouseleave', ()=> { mapFrame.style.pointerEvents = 'none'; });

</script>
</body>
</html>
